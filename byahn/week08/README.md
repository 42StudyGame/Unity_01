# Week08

## 8주차 내용
- 8주차: 7부 네트워크 협동 게임: 좀비 서바이버 멀티플레이어 (816p - 933p)

## 내용 정리
### 18장 좀비 서바이버 : 멀티 플레이어
#### 다루는 내용
	- 로컬과 리모트의 구분
	- 네트워크 권한에 따라 코드를 분리하는 방법
	- 클라이언트 사이에서 수치가 동기화되는 흐름
	- 게임 서버의 종류
	- RPC
	- PUN(Photon Unity Network) 준비하기
	- 로비를 만들고 매치메이킹을 구현하는 방법

- 게임 서버의 종류
	- 전용 서버
		- 서버의 모든 자원이 온전히 네트워크 서비스를 유지하는데 사용 된다.
		- 서버가 플레이어로서 게임에 직접 참가하지 않는 형태
		- 고정 비용이 많이 발생한다.
	- 리슨 서버
		- 플레이어 클라이언트 중 하나가 서버 역할을 맡는다.
		- 리슨 서버는 게임에 플레이어로 참가하기 때문에 Play as Host 라고 부르기도 한다.
		- 전용 서버에 비해 서비스 유지비용이 적다.
		- 물리적으로 매우 가까운 위치에 있는 플레이어들끼리는 네트워크 반응 속도가 전용 서버보다 빠르다.
		- 호스트 플레이어의 컴퓨터 성능에 따라 네트워크 품질이 크게 달라진다.
		- 호스트가 게임을 종료할 경우 남은 클라이언트 중에서 새로운 호스트를 선정하는 절차가 필요하다.
	- P2P
		- 참가한 클라이언트들 모두가 호스트 역할을 겸한다.
		- 참가자가 증가할수록 반응 속도가 눈에 띄게 느려진다. 따라서 통상 16명을 상한선으로 여긴다.
		- 수치 변조에 제일 취약하다. 각 클라이언트가 연산을 실행하고 서로 동기화하기 때문에 특정 중요 수치를 위조하여 다른 클라이언트에 전파알 위험이 크기 때문이다.

- MonoBehaviourPunCallbacks
	- MonoBehaviour의 기능을 유지한 채 컴포넌트가 포톤 서비스에 의해 발생하는 콜백(이벤트나 메시지)도 감지할 수 있게 한다.
	- OnConnectedToMaster(), OnDisconnected() 등의 포톤 이벤트를 감지하고 대응되는 메서드를 자동 실행한다.
- PhotonNetwork.LoadLevel()
	- SceneManager.LoadScene()은 이전 씬의 모든 게임 오브젝트를 삭제하고 다음 씬을 로드하므로 로비 씬의 네트워크 정보가 유지되지 않는다. 또한 플레이어들이 서로 동기화 없이 각자 Main 씬을 로드하기 때문에 다른 사람의 캐릭터가 보이지 않는다.
	- PhotonNetwork.LoadLevel()은 어떤 씬을 로드하고, 해당 씬의 구성이 플레이어 사이에서 동기화되도록 유지한다.

### 19장 좀비 서바이버 : 멀티 플레이어
#### 다루는 내용
	- 싱글플레이어 게임을 멀티플레이어로 포팅하는 전반적인 방향
	- 로컬과 리모트를 코드로 구별하는 방법
	- 호스트에서만 특정 처리를 실행하고, 결과를 클라이언트에 전파하는 방법
	- PUN의 다양한 컴포넌트
	- Photon View 컴포넌트를 사용해 로컬과 리모트 사이의 동기화
	- [PunRPC] 속성
	- 직렬화와 역직렬화

- Photon View 컴포넌트
	- 네트워크를 통해 동기화될 모든 게임 오브젝트는 Photon View 컴포넌트를 가져야 한다.
	- 게임 오브젝트에 네트워크상에서 구별 가능한 식별자인 View ID를 부여한다. 또한 Observed Components 리스트에 등록된 컴포넌트들의 변화한 수치를 관측하고, 네트워크를 넘어서 다른 클라이언트에 전달할 수 있다. 즉 Photon View 컴포넌트를 가진 게임 오브젝트는 로컬과 리모트 구분이 가능해지며 다른 클라이언트에 있는 자신에게 관측된 수치를 전달하고 동기화할 수 있다.
	- Photon View 컴포넌트가 관측할 컴포넌트는 Observed Components 리스트에 할당하면 된다. IPunObservable 인터페이스를 상속한 컴포넌트만 관측할 수 있다.

- Photon Transform View 컴포넌트
	- 자신의 게임 오브젝트에 추가된 트랜스폼 컴포넌트 값의 변화를 측정하고, Photon View 컴포넌트를 사용해 동기화한다.
	- 자신이 로컬이라면 트랜스폼 컴포넌트의 속성값들을 감지하고 Photon View 컴포넌트를 사용해 네트워크 너머의 리모트로 보낸다. 자신이 리모트라면 Photon View 컴포넌트를 사용해 송신된 로컬의 값을 받아 자신의 트랜스폼 컴포넌트에 적용한다.
	- Photon View 없이는 동작할 수 없다.

- Photon Animator View 컴포넌트
	- 로컬과 리모트 사이에서 애니메이터 컴포넌트의 파라미터를 동기화하여 서로 같은 애니메이션을 재생하도록 한다.

- MonoBehaviourPun
	- MonoBehaviour에서 photonView 프로퍼티만 추가하여 단순 확장한 클래스